{"ast":null,"code":"var WebSocket = WebSocket || require('ws');\nmodule.exports = function (self) {\n  var socket = null;\n  function handleSocketMessage(ev) {\n    var data = ev.data;\n    if (data instanceof ArrayBuffer) {\n      // binary message, transfer for speed\n      self.postMessage(data, [data]);\n    } else {\n      // JSON message, copy string\n      self.postMessage(data);\n    }\n  }\n  function handleSocketControl(ev) {\n    self.postMessage({\n      type: ev.type\n    });\n  }\n  self.addEventListener('message', function (ev) {\n    var data = ev.data;\n    if (typeof data === 'string') {\n      // JSON message from ROSLIB\n      socket.send(data);\n    } else {\n      // control message\n      if (data.hasOwnProperty('close')) {\n        socket.close();\n        socket = null;\n      } else if (data.hasOwnProperty('uri')) {\n        var uri = data.uri;\n        socket = new WebSocket(uri);\n        socket.binaryType = 'arraybuffer';\n        socket.onmessage = handleSocketMessage;\n        socket.onclose = handleSocketControl;\n        socket.onopen = handleSocketControl;\n        socket.onerror = handleSocketControl;\n      } else {\n        throw 'Unknown message to WorkerSocket';\n      }\n    }\n  });\n};","map":null,"metadata":{},"sourceType":"script"}