{"ast":null,"code":"/**\n * @fileOverview\n * @author Graeme Yeates - github.com/megawac\n */\n\n'use strict';\n\nvar Canvas = require('canvas');\nvar Image = Canvas.Image || window.Image;\n\n/**\n * If a message was compressed as a PNG image (a compression hack since\n * gzipping over WebSockets * is not supported yet), this function places the\n * \"image\" in a canvas element then decodes the * \"image\" as a Base64 string.\n *\n * @private\n * @param data - An object containing the PNG data.\n * @param callback - Function with the following params:\n * @param callback.data - The uncompressed data.\n */\nfunction decompressPng(data, callback) {\n  // Uncompresses the data before sending it through (use image/canvas to do so).\n  var image = new Image();\n  // When the image loads, extracts the raw data (JSON message).\n  image.onload = function () {\n    // Creates a local canvas to draw on.\n    var canvas = new Canvas();\n    var context = canvas.getContext('2d');\n\n    // Sets width and height.\n    canvas.width = image.width;\n    canvas.height = image.height;\n\n    // Prevents anti-aliasing and loosing data\n    context.imageSmoothingEnabled = false;\n    context.webkitImageSmoothingEnabled = false;\n    context.mozImageSmoothingEnabled = false;\n\n    // Puts the data into the image.\n    context.drawImage(image, 0, 0);\n    // Grabs the raw, uncompressed data.\n    var imageData = context.getImageData(0, 0, image.width, image.height).data;\n\n    // Constructs the JSON.\n    var jsonData = '';\n    for (var i = 0; i < imageData.length; i += 4) {\n      // RGB\n      jsonData += String.fromCharCode(imageData[i], imageData[i + 1], imageData[i + 2]);\n    }\n    callback(JSON.parse(jsonData));\n  };\n  // Sends the image data to load.\n  image.src = 'data:image/png;base64,' + data;\n}\nmodule.exports = decompressPng;","map":null,"metadata":{},"sourceType":"script"}